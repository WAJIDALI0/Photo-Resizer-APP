<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∏ Photo Resizer App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.9;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            margin: 25px 0;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .section h2 {
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 2px;
        }

        .file-input {
            width: 100%;
            padding: 20px;
            border: 3px dashed #ff6b6b;
            border-radius: 15px;
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-input:hover {
            border-color: #ee5a24;
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            transform: scale(1.02);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .preset-btn {
            padding: 16px 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .custom-size {
            display: flex;
            gap: 20px;
            border-top: 1px solid rgba(0,0,0,0.1);
            padding-top: 20px;
            margin-top: 20px;
        }

        .custom-size label {
            display: flex;
            flex-direction: column;
            flex: 1;
            font-weight: 500;
            color: #4a5568;
        }

        .custom-size input {
            margin-top: 8px;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .custom-size input:focus {
            outline: none;
            border-color: #ff6b6b;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .color-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .color-btn {
            padding: 16px 12px;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .color-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-btn:hover::before {
            opacity: 1;
        }

        .color-btn.selected {
            border-color: #2d3748;
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(0,0,0,0.2);
        }

        .color-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .count-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .count-btn {
            padding: 12px 18px;
            background: linear-gradient(135deg, #f1f3f4, #e8eaed);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: #5f6368;
            transition: all 0.3s ease;
            min-width: 50px;
        }

        .count-btn:hover {
            background: linear-gradient(135deg, #e8eaed, #dadce0);
            transform: translateY(-1px);
        }

        .count-btn.selected {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .photo-item {
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 90px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .photo-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item span {
            font-size: 11px;
            color: #718096;
            text-align: center;
            font-weight: 500;
        }

        .info {
            text-align: center;
            color: #4a5568;
            font-weight: 600;
            font-size: 16px;
            padding: 15px;
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
        }

        .print-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .share-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            color: white;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .section { padding: 15px; margin: 10px 0; }
            .section h2 { font-size: 1.2rem; }
            .custom-size { flex-direction: column; gap: 10px; }
            .action-buttons { flex-direction: column; align-items: center; gap: 10px; }
            .action-btn { width: 100%; max-width: 280px; padding: 12px 20px; font-size: 14px; }
            .header { padding: 20px 15px; }
            .header h1 { font-size: 1.8rem; }
            .header p { font-size: 1rem; }
            .preset-buttons { grid-template-columns: 1fr; gap: 10px; }
            .preset-btn { padding: 12px 15px; font-size: 13px; }
            .color-buttons { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .color-btn { padding: 12px 8px; font-size: 11px; }
            .count-buttons { gap: 8px; }
            .count-btn { padding: 8px 12px; font-size: 12px; min-width: 40px; }
            .photo-grid { padding: 15px; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); }
            .photo-item { min-height: 70px; }
            .info { font-size: 14px; padding: 12px; }
            .file-input { padding: 15px; font-size: 14px; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 8px; }
            .section { padding: 12px; margin: 8px 0; }
            .header h1 { font-size: 1.5rem; }
            .header p { font-size: 0.9rem; }
            .preset-btn { padding: 10px 12px; font-size: 12px; }
            .color-btn { padding: 10px 6px; font-size: 10px; }
            .count-btn { padding: 6px 10px; font-size: 11px; min-width: 35px; }
            .action-btn { padding: 10px 15px; font-size: 13px; }
            .photo-grid { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); }
            .photo-item { min-height: 60px; }
            .custom-size input { padding: 10px 12px; font-size: 14px; }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }

        .success-message {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .info-message {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }

        .warning-message {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .editor-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            width: 95vw;
            height: 90vh;
            position: relative;
            display: flex;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .editor-modal {
                padding: 0;
                align-items: flex-start;
            }
            .editor-content {
                width: 100vw;
                height: 100vh;
                max-width: none;
                max-height: none;
                border-radius: 0;
                padding: 10px;
                display: block;
                overflow-y: auto;
            }
            .editor-left {
                width: 100%;
                margin-bottom: 20px;
                text-align: center;
            }
            .editor-right {
                width: 100%;
                padding: 0;
                background: transparent;
            }
            .editor-canvas {
                width: 90vw;
                max-width: 90vw;
                height: auto;
                max-height: 40vh;
            }
            .editor-controls {
                gap: 15px;
            }
            .control-group {
                padding: 12px;
                margin-bottom: 10px;
                background: white;
                border-radius: 10px;
            }
            .control-group h4 {
                font-size: 16px;
                margin-bottom: 10px;
            }
            .preset-btn {
                padding: 12px 15px;
                font-size: 14px;
                margin: 5px 0;
            }
            .count-btn {
                padding: 10px 12px;
                font-size: 12px;
            }
            .close-btn {
                top: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 18px;
                z-index: 1001;
            }
        }

        .editor-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .editor-right {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
            border-radius: 15px;
        }

        .editor-canvas {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            max-width: 100%;
            max-height: 70vh;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .editor-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
        }

        .control-group h4 {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .slider {
            width: 100%;
            margin: 10px 0;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 18px;
        }

        /* Floating AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .ai-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .ai-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0,0,0,0.4);
        }
        
        .ai-chat {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
        }
        
        @media (max-width: 768px) {
            .ai-chat {
                width: 300px;
                height: 350px;
                right: -10px;
            }
            .ai-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .ai-chat {
                width: 280px;
                height: 300px;
                right: -20px;
            }
            .ai-button {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }
        
        .ai-header {
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
            font-weight: 600;
        }
        
        .ai-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 250px;
        }
        
        .ai-input-area {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        
        .ai-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        .ai-send {
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .user-message {
            background: #e3f2fd;
            margin-left: auto;
        }
        
        .ai-message {
            background: #f5f5f5;
        }
        
        .crop-overlay {
            box-sizing: border-box;
            transition: border-color 0.2s ease;
        }
        
        .crop-overlay:hover {
            border-color: #ee5a24;
            background: rgba(238, 90, 36, 0.1);
        }
        
        .crop-handle:hover {
            background: #ee5a24 !important;
            transform: scale(1.1);
        }

        @media print {
            .header, .section:not(.photo-section) { display: none !important; }
            .photo-grid { background: white !important; padding: 0 !important; }
            .ai-assistant { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì∏ Photo Resizer</h1>
        <p>Create passport & ID photos with custom dimensions</p>
    </div>

    <div class="container">
        <!-- Photo Upload -->
        <div class="section">
            <h2>Upload Photo</h2>
            <input type="file" accept="image/*" id="imageInput" class="file-input">
            <div style="margin-top: 15px; text-align: center;">
                <label style="display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 500;">
                    <input type="checkbox" id="autoRemoveBg" checked style="transform: scale(1.2);">
                    ü§ñ Auto remove background with AI
                </label>
            </div>
            <div id="editSection" style="display: none; margin-top: 20px; text-align: center;">
                <button class="action-btn" style="background: linear-gradient(135deg, #9f7aea, #805ad5); color: white;" onclick="openEditor()">‚úèÔ∏è Edit Photo</button>
            </div>
        </div>

        <!-- Dimension Selector -->
        <div class="section">
            <h2>Photo Dimensions (inches)</h2>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="setDimensions(2, 2)">Passport (2√ó2)</button>
                <button class="preset-btn" onclick="setDimensions(1.5, 2)">ID Card (1.5√ó2)</button>
                <button class="preset-btn" onclick="setDimensions(2, 2)">Visa (2√ó2)</button>
                <button class="preset-btn" onclick="setDimensions(1.25, 1.5)">License (1.25√ó1.5)</button>
            </div>
            <div class="custom-size">
                <label>
                    Width:
                    <input type="number" step="0.1" value="2" id="widthInput">
                </label>
                <label>
                    Height:
                    <input type="number" step="0.1" value="2" id="heightInput">
                </label>
            </div>
        </div>

        <!-- Background Color -->
        <div class="section">
            <h2>Background Color</h2>
            <div class="color-buttons">
                <button class="color-btn selected" style="background-color: #FFFFFF; color: #000;" onclick="setBackgroundColor('#FFFFFF', this)">White</button>
                <button class="color-btn" style="background-color: #2196F3; color: white;" onclick="setBackgroundColor('#2196F3', this)">Blue</button>
                <button class="color-btn" style="background-color: #F44336; color: white;" onclick="setBackgroundColor('#F44336', this)">Red</button>
                <button class="color-btn" style="background-color: #9E9E9E; color: white;" onclick="setBackgroundColor('#9E9E9E', this)">Gray</button>
                <button class="color-btn" style="background-color: #87CEEB; color: white;" onclick="setBackgroundColor('#87CEEB', this)">Light Blue</button>
                <button class="color-btn" style="background-color: #F5F5DC; color: #000;" onclick="setBackgroundColor('#F5F5DC', this)">Cream</button>
            </div>
        </div>

        <!-- Photo Count -->
        <div class="section">
            <h2>Photos per page</h2>
            <div class="count-buttons">
                <button class="count-btn selected" onclick="setPhotoCount(4, this)">4</button>
                <button class="count-btn" onclick="setPhotoCount(8, this)">8</button>
                <button class="count-btn" onclick="setPhotoCount(12, this)">12</button>
                <button class="count-btn" onclick="setPhotoCount(16, this)">16</button>
                <button class="count-btn" onclick="setPhotoCount(20, this)">20</button>
                <button class="count-btn" onclick="setPhotoCount(24, this)">24</button>
            </div>
            <div class="custom-size" style="margin-top: 15px;">
                <label>
                    Custom Count:
                    <input type="number" min="1" max="50" value="4" id="customCountInput">
                </label>
            </div>
        </div>

        <!-- Photo Grid -->
        <div class="section photo-section">
            <h2>Preview</h2>
            <div class="photo-grid" id="photoGrid"></div>
            <p class="info" id="infoText">Size: 2" √ó 2" | Count: 4</p>
        </div>



        <!-- Action Buttons -->
        <div class="section">
            <div class="action-buttons">
                <button class="action-btn print-btn" onclick="printPhotos()">üñ®Ô∏è Print</button>
                <button class="action-btn share-btn" onclick="sharePhotos()">üì± Share</button>
                <button class="action-btn save-btn" onclick="savePhotos()">üíæ Save</button>
            </div>
        </div>
    </div>

    <!-- Floating AI Assistant -->
    <div class="ai-assistant">
        <button class="ai-button" onclick="toggleAI()">ü§ñ</button>
        <div class="ai-chat" id="aiChat">
            <div class="ai-header">
                ü§ñ WAJID Assistant
                <button onclick="toggleAI()" style="float: right; background: none; border: none; color: white; cursor: pointer;">&times;</button>
            </div>
            <div class="ai-messages" id="aiMessages">
                <div class="message ai-message">
                    Hi! I'm WAJID Assistant. I can help you remove backgrounds, crop photos, change hair styles, and create perfect passport photos!
                </div>
            </div>
            <div class="ai-input-area">
                <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything...">
                <button class="ai-send" onclick="sendAIMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        let selectedImage = null;
        let dimensions = { width: 2, height: 2 };
        let photoCount = 4;
        let backgroundColor = '#FFFFFF';

        let originalImage = null;
        let editedImage = null;

        // Image upload handler
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    originalImage = e.target.result;
                    const autoRemove = document.getElementById('autoRemoveBg').checked;
                    if (autoRemove) {
                        removeBackground(e.target.result);
                    } else {
                        selectedImage = e.target.result;
                        updatePhotoGrid();
                    }
                    document.getElementById('editSection').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Auto Background Removal with API integration
        async function removeBackground(imageData) {
            try {
                showMessage('ü§ñ AI removing background...', 'info');
                
                // Try API first
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = async function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    try {
                        // Use Remove.bg API
                        const imageBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
                        const formData = new FormData();
                        formData.append('image_file', imageBlob);
                        formData.append('size', 'auto');
                        
                        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                            method: 'POST',
                            headers: {
                                'X-Api-Key': 'uam3YSA7Dkz6SHVkf8DLVWUE'
                            },
                            body: formData
                        });
                        
                        if (response.ok) {
                            const blob = await response.blob();
                            const apiImg = new Image();
                            apiImg.onload = function() {
                                canvas.width = apiImg.width;
                                canvas.height = apiImg.height;
                                ctx.clearRect(0, 0, canvas.width, canvas.height);
                                ctx.drawImage(apiImg, 0, 0);
                                selectedImage = canvas.toDataURL();
                                updatePhotoGrid();
                                showMessage('‚úÖ AI background removed perfectly!', 'success');
                            };
                            apiImg.src = URL.createObjectURL(blob);
                            return;
                        }
                    } catch (apiError) {
                        console.log('API failed, using local removal');
                    }
                    
                    // Fallback to local removal
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    let removedPixels = 0;
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        const brightness = (r + g + b) / 3;
                        const colorVariance = Math.abs(r - g) + Math.abs(g - b) + Math.abs(r - b);
                        
                        if (brightness > 180 && colorVariance < 30) {
                            data[i + 3] = 0;
                            removedPixels++;
                        }
                    }
                    
                    ctx.putImageData(imageData, 0, 0);
                    selectedImage = canvas.toDataURL();
                    updatePhotoGrid();
                    showMessage('‚úÖ Local background removal applied!', 'success');
                };
                
                img.src = imageData;
            } catch (error) {
                selectedImage = imageData;
                updatePhotoGrid();
                showMessage('‚ö†Ô∏è Using original image', 'warning');
            }
        }

        function showMessage(text, type) {
            const existing = document.querySelector('.message');
            if (existing) existing.remove();
            
            const message = document.createElement('div');
            message.className = `message ${type}-message`;
            message.textContent = text;
            
            const container = document.querySelector('.container');
            container.insertBefore(message, container.firstChild);
            
            setTimeout(() => message.remove(), 3000);
        }

        // Dimension inputs
        document.getElementById('widthInput').addEventListener('input', function() {
            dimensions.width = parseFloat(this.value) || 2;
            updatePhotoGrid();
            updateInfo();
        });

        document.getElementById('heightInput').addEventListener('input', function() {
            dimensions.height = parseFloat(this.value) || 2;
            updatePhotoGrid();
            updateInfo();
        });

        // Custom count input
        document.getElementById('customCountInput').addEventListener('input', function() {
            const count = parseInt(this.value) || 4;
            if (count >= 1 && count <= 50) {
                photoCount = count;
                document.querySelectorAll('.count-btn').forEach(btn => btn.classList.remove('selected'));
                updatePhotoGrid();
                updateInfo();
            }
        });

        function setDimensions(width, height) {
            dimensions = { width, height };
            document.getElementById('widthInput').value = width;
            document.getElementById('heightInput').value = height;
            updatePhotoGrid();
            updateInfo();
        }

        function setBackgroundColor(color, button) {
            backgroundColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            updatePhotoGrid();
        }

        function setPhotoCount(count, button) {
            photoCount = count;
            document.querySelectorAll('.count-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            updatePhotoGrid();
            updateInfo();
        }

        function updatePhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < photoCount; i++) {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.style.backgroundColor = backgroundColor;
                photoItem.style.aspectRatio = `${dimensions.width}/${dimensions.height}`;
                
                if (selectedImage) {
                    // Create canvas to composite image with background
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        // Fill background color first
                        ctx.fillStyle = backgroundColor;
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        
                        // Draw image on top
                        ctx.drawImage(img, 0, 0);
                        
                        // Create final image element
                        const finalImg = document.createElement('img');
                        finalImg.src = canvas.toDataURL();
                        finalImg.alt = `Photo ${i + 1}`;
                        finalImg.style.width = '100%';
                        finalImg.style.height = '100%';
                        finalImg.style.objectFit = 'cover';
                        
                        photoItem.appendChild(finalImg);
                    };
                    
                    img.src = selectedImage;
                } else {
                    const span = document.createElement('span');
                    span.textContent = `Photo ${i + 1}`;
                    photoItem.appendChild(span);
                }
                
                grid.appendChild(photoItem);
            }
        }

        function updateInfo() {
            document.getElementById('infoText').textContent = 
                `Size: ${dimensions.width}" √ó ${dimensions.height}" | Count: ${photoCount}`;
        }

        function printPhotos() {
            if (!selectedImage) {
                alert('Please select an image first');
                return;
            }
            window.print();
        }

        async function sharePhotos() {
            if (!selectedImage) {
                alert('Please select an image first');
                return;
            }
            
            try {
                // Create canvas with all photos for sharing
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = 800;
                canvas.height = 600;
                
                // Fill with white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Create image element
                const img = new Image();
                img.onload = async function() {
                    // Draw a few photos on canvas
                    const photoSize = 150;
                    const spacing = 20;
                    const photosPerRow = 3;
                    
                    for (let i = 0; i < Math.min(photoCount, 6); i++) {
                        const col = i % photosPerRow;
                        const row = Math.floor(i / photosPerRow);
                        const x = spacing + col * (photoSize + spacing);
                        const y = spacing + row * (photoSize + spacing);
                        
                        // Draw background
                        ctx.fillStyle = backgroundColor;
                        ctx.fillRect(x, y, photoSize, photoSize);
                        
                        // Draw image
                        ctx.drawImage(img, x, y, photoSize, photoSize);
                    }
                    
                    // Convert to blob for sharing
                    canvas.toBlob(async (blob) => {
                        try {
                            if (navigator.share && navigator.canShare) {
                                const file = new File([blob], 'passport-photos.png', { type: 'image/png' });
                                
                                if (navigator.canShare({ files: [file] })) {
                                    await navigator.share({
                                        title: 'My Passport Photos',
                                        text: 'Created with Photo Resizer App',
                                        files: [file]
                                    });
                                } else {
                                    // Fallback: share without file
                                    await navigator.share({
                                        title: 'Photo Resizer App',
                                        text: 'Check out this amazing photo resizer app!',
                                        url: window.location.href
                                    });
                                }
                            } else {
                                // Fallback for browsers without Web Share API
                                downloadBlob(blob, 'passport-photos.png');
                                alert('Photo downloaded! You can now share it from your gallery.');
                            }
                        } catch (error) {
                            console.error('Share failed:', error);
                            // Final fallback: download the image
                            downloadBlob(blob, 'passport-photos.png');
                            alert('Photo downloaded! You can share it from your gallery.');
                        }
                    }, 'image/png');
                };
                
                img.src = selectedImage;
                
            } catch (error) {
                console.error('Share error:', error);
                alert('Share not supported. Try the Save button instead!');
            }
        }
        
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function savePhotos() {
            if (!selectedImage) {
                alert('Please select an image first');
                return;
            }
            
            // Create canvas to combine all photos
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (A4 size in pixels at 300 DPI)
            canvas.width = 2480;
            canvas.height = 3508;
            
            // Fill with white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Create image element
            const img = new Image();
            img.onload = function() {
                // Calculate photo dimensions and layout
                const cols = Math.ceil(Math.sqrt(photoCount));
                const rows = Math.ceil(photoCount / cols);
                const photoWidth = Math.min(300, canvas.width / cols - 20);
                const photoHeight = photoWidth * (dimensions.height / dimensions.width);
                
                // Draw photos
                for (let i = 0; i < photoCount; i++) {
                    const col = i % cols;
                    const row = Math.floor(i / cols);
                    const x = col * (photoWidth + 10) + 10;
                    const y = row * (photoHeight + 10) + 10;
                    
                    // Draw background color first
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(x, y, photoWidth, photoHeight);
                    
                    // Draw image on top of background
                    ctx.drawImage(img, x, y, photoWidth, photoHeight);
                }
                
                // Download the image
                const link = document.createElement('a');
                link.download = `passport-photos-${dimensions.width}x${dimensions.height}-${photoCount}pics.png`;
                link.href = canvas.toDataURL();
                link.click();
            };
            img.src = selectedImage;
        }

        // Photo Editor Functions
        function openEditor() {
            if (!selectedImage) return;
            
            const modal = document.createElement('div');
            modal.className = 'editor-modal';
            modal.innerHTML = `
                <div class="editor-content">
                    <button class="close-btn" onclick="closeEditor()">&times;</button>
                    
                    <div class="editor-left">
                        <h2 style="margin-bottom: 15px;">üì∏ Photo Editor</h2>
                        <canvas id="editorCanvas" class="editor-canvas" width="400" height="400"></canvas>
                        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                            <button class="action-btn" onclick="applyEdits()" style="padding: 12px 24px; font-size: 14px;">‚úÖ Apply</button>
                            <button class="action-btn" onclick="resetEdits()" style="padding: 12px 24px; font-size: 14px;">üîÑ Reset</button>
                        </div>
                    </div>
                    
                    <div class="editor-right">
                        <div class="editor-controls">
                            <div class="control-group">
                                <h4>üé® Background Removal</h4>
                                <button class="preset-btn" onclick="aiBackgroundRemoval()" style="width: 100%; margin: 5px 0; background: linear-gradient(135deg, #4CAF50, #45a049);">ü§ñ AI Remove (API)</button>
                                <button class="preset-btn" onclick="canvaStyleRemoval()" style="width: 100%; margin: 5px 0;">üé® Local Remove</button>
                                <button class="preset-btn" onclick="enableBrushMode()" style="width: 100%; margin: 5px 0;">üñåÔ∏è Brush Remove</button>
                                <button class="preset-btn" onclick="enableColorPicker()" style="width: 100%; margin: 5px 0;">üéØ Pick Color</button>

                                <div style="margin: 10px 0;">
                                    <label style="font-size: 14px; display: block; margin-bottom: 5px;">Brush Size:</label>
                                    <input type="range" id="brushSize" min="5" max="50" value="20" style="width: 100%; height: 35px;">
                                    <small style="font-size: 12px;">Size: <span id="brushSizeValue">20px</span></small>
                                </div>
                                <label style="display: block; margin: 10px 0; font-size: 14px;">New Background:</label>
                                <input type="color" id="bgColorPicker" value="${backgroundColor}" onchange="changeBgColor(this.value)" style="width: 100%; height: 45px; border-radius: 8px; border: none;">
                            </div>
                            
                            <div class="control-group">
                                <h4>‚úÇÔ∏è Professional Crop</h4>
                                <button class="preset-btn" onclick="enableProfessionalCrop()" style="width: 100%; margin: 5px 0;">üìê Start Cropping</button>
                                <button class="preset-btn" onclick="cropToFace()" style="width: 100%; margin: 5px 0;">Auto Face Crop</button>
                                <div id="cropControls" style="display: none; margin: 8px 0;">
                                    <button class="count-btn" onclick="applyCrop()" style="width: 48%; margin: 1px; background: #4CAF50; color: white; padding: 8px 5px; font-size: 11px;">‚úÖ Apply</button>
                                    <button class="count-btn" onclick="cancelCrop()" style="width: 48%; margin: 1px; background: #f44336; color: white; padding: 8px 5px; font-size: 11px;">‚ùå Cancel</button>
                                </div>
                                <button class="preset-btn" onclick="resetCrop()" style="width: 100%; margin: 5px 0;">üîÑ Reset All</button>
                            </div>
                            
                            <div class="control-group">
                                <h4>üíá Hair Style Changer</h4>
                                <button class="preset-btn" onclick="changeHairStyle('short')" style="width: 100%; margin: 3px 0;">üë® Short Hair</button>
                                <button class="preset-btn" onclick="changeHairStyle('long')" style="width: 100%; margin: 3px 0;">üë© Long Hair</button>
                                <button class="preset-btn" onclick="changeHairStyle('curly')" style="width: 100%; margin: 3px 0;">üåÄ Curly Hair</button>
                                <button class="preset-btn" onclick="changeHairStyle('bald')" style="width: 100%; margin: 3px 0;">üë®‚Äçü¶≤ Bald</button>
                                <button class="preset-btn" onclick="changeHairColor()" style="width: 100%; margin: 3px 0;">üé® Change Hair Color</button>
                            </div>
                            
                            <div class="control-group">
                                <h4>üéõÔ∏è Enhance Photo</h4>
                                <label style="font-size: 12px;">Brightness:</label>
                                <input type="range" class="slider" min="-50" max="50" value="0" onchange="adjustBrightness(this.value)" style="height: 25px;">
                                <label style="font-size: 12px;">Contrast:</label>
                                <input type="range" class="slider" min="-50" max="50" value="0" onchange="adjustContrast(this.value)" style="height: 25px;">
                                <label style="font-size: 12px;">Saturation:</label>
                                <input type="range" class="slider" min="-50" max="50" value="0" onchange="adjustSaturation(this.value)" style="height: 25px;">
                            </div>
                            
                            <div class="control-group">
                                <h4>üíÑ Beauty Tools</h4>
                                <button class="count-btn" onclick="smoothSkin()" style="width: 100%; margin: 5px 0;">Smooth Skin</button>
                                <button class="count-btn" onclick="whitenTeeth()" style="width: 100%; margin: 5px 0;">Whiten Teeth</button>
                                <button class="count-btn" onclick="brightenEyes()" style="width: 100%; margin: 5px 0;">Brighten Eyes</button>
                                <button class="count-btn" onclick="autoEnhance()" style="width: 100%; margin: 5px 0;">‚ú® Auto Enhance</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            loadImageToEditor();
        }
        
        function closeEditor() {
            const modal = document.querySelector('.editor-modal');
            if (modal) modal.remove();
        }
        
        function loadImageToEditor() {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = Math.min(400, img.width);
                canvas.height = (canvas.width / img.width) * img.height;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Store original canvas data for background changes
                originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            };
            
            img.src = selectedImage;
        }
        
        function removeEditorBackground() {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // Better background removal algorithm
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                const brightness = (r + g + b) / 3;
                const colorVariance = Math.abs(r - g) + Math.abs(g - b) + Math.abs(r - b);
                
                // Remove light, uniform backgrounds
                if (brightness > 170 && colorVariance < 40) {
                    data[i + 3] = 0; // Make transparent
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            // Update stored original data
            originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            showMessage('‚úÇÔ∏è Background removed!', 'success');
        }
        
        function smartBackgroundRemoval() {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // Smart edge-based removal
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Multiple criteria for better detection
                const brightness = (r + g + b) / 3;
                const isWhitish = r > 160 && g > 160 && b > 160;
                const isUniform = Math.abs(r - g) < 30 && Math.abs(g - b) < 30;
                
                if ((brightness > 180 && isUniform) || (isWhitish && isUniform)) {
                    data[i + 3] = 0; // Make transparent
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            // Update stored original data
            originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            showMessage('ü§ñ Smart background removal applied!', 'success');
        }
        
        function centerImage() {
            showMessage('üéØ Image centered!', 'success');
        }
        
        function adjustSaturation(value) {
            showMessage(`üé® Saturation: ${value > 0 ? '+' : ''}${value}`, 'info');
        }
        
        function autoEnhance() {
            adjustBrightness(10);
            adjustContrast(15);
            showMessage('‚ú® Auto enhancement applied!', 'success');
        }
        
        let cropMode = false;
        let colorPickerMode = false;
        let cropStart = null;
        let cropEnd = null;
        
        function enableManualCrop() {
            cropMode = true;
            colorPickerMode = false;
            const canvas = document.getElementById('editorCanvas');
            canvas.style.cursor = 'crosshair';
            showMessage('üìê Click and drag to crop area', 'info');
            
            canvas.addEventListener('mousedown', startCrop);
            canvas.addEventListener('mousemove', drawCrop);
            canvas.addEventListener('mouseup', endCrop);
        }
        
        function enableColorPicker() {
            colorPickerMode = true;
            cropMode = false;
            const canvas = document.getElementById('editorCanvas');
            canvas.style.cursor = 'crosshair';
            showMessage('üéØ Click on color to remove', 'info');
            
            canvas.addEventListener('click', pickColorToRemove);
        }
        
        function startCrop(e) {
            if (!cropMode) return;
            const rect = e.target.getBoundingClientRect();
            cropStart = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }
        
        function drawCrop(e) {
            if (!cropMode || !cropStart) return;
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const rect = e.target.getBoundingClientRect();
            
            cropEnd = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            // Redraw image
            loadImageToEditor();
            
            // Draw crop rectangle
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(
                cropStart.x,
                cropStart.y,
                cropEnd.x - cropStart.x,
                cropEnd.y - cropStart.y
            );
        }
        
        function endCrop(e) {
            if (!cropMode || !cropStart) return;
            
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            
            // Calculate crop area
            const width = Math.abs(cropEnd.x - cropStart.x);
            const height = Math.abs(cropEnd.y - cropStart.y);
            const x = Math.min(cropStart.x, cropEnd.x);
            const y = Math.min(cropStart.y, cropEnd.y);
            
            if (width > 10 && height > 10) {
                // Get cropped image data
                const imageData = ctx.getImageData(x, y, width, height);
                
                // Resize canvas and draw cropped image
                canvas.width = width;
                canvas.height = height;
                ctx.putImageData(imageData, 0, 0);
                
                showMessage('‚úÇÔ∏è Image cropped successfully!', 'success');
            }
            
            // Reset crop mode
            cropMode = false;
            canvas.style.cursor = 'default';
            canvas.removeEventListener('mousedown', startCrop);
            canvas.removeEventListener('mousemove', drawCrop);
            canvas.removeEventListener('mouseup', endCrop);
        }
        
        function pickColorToRemove(e) {
            if (!colorPickerMode) return;
            
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Get pixel color
            const imageData = ctx.getImageData(x, y, 1, 1);
            const [r, g, b] = imageData.data;
            
            showMessage(`üéØ Removing color RGB(${r}, ${g}, ${b})`, 'info');
            
            // Remove similar colors
            removeColorFromImage(r, g, b);
            
            // Reset color picker mode
            colorPickerMode = false;
            canvas.style.cursor = 'default';
            canvas.removeEventListener('click', pickColorToRemove);
        }
        
        function removeColorFromImage(targetR, targetG, targetB) {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            const tolerance = 30; // Color similarity tolerance
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Calculate color distance
                const distance = Math.sqrt(
                    Math.pow(r - targetR, 2) +
                    Math.pow(g - targetG, 2) +
                    Math.pow(b - targetB, 2)
                );
                
                // Remove similar colors
                if (distance < tolerance) {
                    data[i + 3] = 0; // Make transparent
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            showMessage('üé® Color removed successfully!', 'success');
        }
        
        function resetCrop() {
            cancelCrop();
            loadImageToEditor();
            showMessage('üîÑ Image reset to original!', 'info');
        }
        
        // Professional Cropping System
        let cropOverlay = null;
        let isDragging = false;
        let isResizing = false;
        let dragStart = null;
        
        function enableProfessionalCrop() {
            cropMode = true;
            const canvas = document.getElementById('editorCanvas');
            canvas.style.position = 'relative';
            
            createCropOverlay(canvas);
            document.getElementById('cropControls').style.display = 'block';
            showMessage('üìê Drag to move, corners to resize. Click Apply when done!', 'info');
        }
        
        function createCropOverlay(canvas) {
            if (cropOverlay) cropOverlay.remove();
            
            const container = canvas.parentElement;
            
            // Get canvas position relative to its container
            const canvasStyle = window.getComputedStyle(canvas);
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // Calculate canvas position within container
            const canvasLeft = canvasRect.left - containerRect.left;
            const canvasTop = canvasRect.top - containerRect.top;
            const canvasWidth = canvasRect.width;
            const canvasHeight = canvasRect.height;
            
            cropOverlay = document.createElement('div');
            cropOverlay.className = 'crop-overlay';
            cropOverlay.style.position = 'absolute';
            cropOverlay.style.left = (canvasLeft + canvasWidth * 0.1) + 'px';
            cropOverlay.style.top = (canvasTop + canvasHeight * 0.1) + 'px';
            cropOverlay.style.width = (canvasWidth * 0.8) + 'px';
            cropOverlay.style.height = (canvasHeight * 0.8) + 'px';
            cropOverlay.style.border = '3px dashed #ff6b6b';
            cropOverlay.style.background = 'rgba(255, 107, 107, 0.15)';
            cropOverlay.style.cursor = 'move';
            cropOverlay.style.zIndex = '1000';
            cropOverlay.style.boxSizing = 'border-box';
            cropOverlay.style.pointerEvents = 'auto';
            
            // Add resize handles
            const handles = ['nw', 'ne', 'sw', 'se'];
            handles.forEach(pos => {
                const handle = document.createElement('div');
                handle.className = 'crop-handle';
                handle.style.position = 'absolute';
                handle.style.width = '15px';
                handle.style.height = '15px';
                handle.style.background = '#ff6b6b';
                handle.style.border = '3px solid white';
                handle.style.borderRadius = '50%';
                handle.style.cursor = pos.includes('n') && pos.includes('w') ? 'nw-resize' : 
                                     pos.includes('n') && pos.includes('e') ? 'ne-resize' :
                                     pos.includes('s') && pos.includes('w') ? 'sw-resize' : 'se-resize';
                handle.style[pos.includes('n') ? 'top' : 'bottom'] = '-9px';
                handle.style[pos.includes('w') ? 'left' : 'right'] = '-9px';
                handle.style.pointerEvents = 'auto';
                handle.onmousedown = (e) => { e.stopPropagation(); startResize(e, pos); };
                cropOverlay.appendChild(handle);
            });
            
            cropOverlay.onmousedown = startDrag;
            container.style.position = 'relative';
            container.appendChild(cropOverlay);
            
            showMessage('üéØ Crop overlay created! Drag to move, corners to resize', 'success');
        }
        
        function startDrag(e) {
            if (e.target.className === 'crop-handle') return;
            isDragging = true;
            dragStart = { x: e.clientX, y: e.clientY };
            document.onmousemove = drag;
            document.onmouseup = stopDrag;
        }
        
        function drag(e) {
            if (!isDragging) return;
            const dx = e.clientX - dragStart.x;
            const dy = e.clientY - dragStart.y;
            
            const canvas = document.getElementById('editorCanvas');
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = canvas.parentElement.getBoundingClientRect();
            
            const canvasLeft = canvasRect.left - containerRect.left;
            const canvasTop = canvasRect.top - containerRect.top;
            const canvasWidth = canvasRect.width;
            const canvasHeight = canvasRect.height;
            
            const overlayWidth = parseInt(cropOverlay.style.width);
            const overlayHeight = parseInt(cropOverlay.style.height);
            
            const newLeft = Math.max(canvasLeft, Math.min(parseInt(cropOverlay.style.left) + dx, canvasLeft + canvasWidth - overlayWidth));
            const newTop = Math.max(canvasTop, Math.min(parseInt(cropOverlay.style.top) + dy, canvasTop + canvasHeight - overlayHeight));
            
            cropOverlay.style.left = newLeft + 'px';
            cropOverlay.style.top = newTop + 'px';
            
            dragStart = { x: e.clientX, y: e.clientY };
        }
        
        function stopDrag() {
            isDragging = false;
            document.onmousemove = null;
            document.onmouseup = null;
        }
        
        function startResize(e, position) {
            isResizing = true;
            dragStart = { x: e.clientX, y: e.clientY, pos: position };
            document.onmousemove = resize;
            document.onmouseup = stopResize;
        }
        
        function resize(e) {
            if (!isResizing) return;
            const dx = e.clientX - dragStart.x;
            const dy = e.clientY - dragStart.y;
            
            const canvas = document.getElementById('editorCanvas');
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = canvas.parentElement.getBoundingClientRect();
            
            const canvasLeft = canvasRect.left - containerRect.left;
            const canvasTop = canvasRect.top - containerRect.top;
            const canvasWidth = canvasRect.width;
            const canvasHeight = canvasRect.height;
            
            let newWidth = parseInt(cropOverlay.style.width);
            let newHeight = parseInt(cropOverlay.style.height);
            let newLeft = parseInt(cropOverlay.style.left);
            let newTop = parseInt(cropOverlay.style.top);
            
            if (dragStart.pos.includes('e')) {
                newWidth = Math.min(newWidth + dx, canvasLeft + canvasWidth - newLeft);
            }
            if (dragStart.pos.includes('w')) {
                const oldWidth = newWidth;
                newWidth = Math.max(50, newWidth - dx);
                const widthDiff = oldWidth - newWidth;
                newLeft = Math.max(canvasLeft, Math.min(newLeft + widthDiff, canvasLeft + canvasWidth - newWidth));
            }
            if (dragStart.pos.includes('s')) {
                newHeight = Math.min(newHeight + dy, canvasTop + canvasHeight - newTop);
            }
            if (dragStart.pos.includes('n')) {
                const oldHeight = newHeight;
                newHeight = Math.max(50, newHeight - dy);
                const heightDiff = oldHeight - newHeight;
                newTop = Math.max(canvasTop, Math.min(newTop + heightDiff, canvasTop + canvasHeight - newHeight));
            }
            
            cropOverlay.style.width = Math.max(50, newWidth) + 'px';
            cropOverlay.style.height = Math.max(50, newHeight) + 'px';
            cropOverlay.style.left = newLeft + 'px';
            cropOverlay.style.top = newTop + 'px';
            
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;
        }
        
        function stopResize() {
            isResizing = false;
            document.onmousemove = null;
            document.onmouseup = null;
        }
        
        function applyCrop() {
            if (!cropOverlay) return;
            
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = canvas.parentElement.getBoundingClientRect();
            
            // Calculate canvas position
            const canvasLeft = canvasRect.left - containerRect.left;
            const canvasTop = canvasRect.top - containerRect.top;
            
            // Calculate crop coordinates relative to canvas
            const scaleX = canvas.width / canvasRect.width;
            const scaleY = canvas.height / canvasRect.height;
            
            const overlayLeft = parseInt(cropOverlay.style.left);
            const overlayTop = parseInt(cropOverlay.style.top);
            const overlayWidth = parseInt(cropOverlay.style.width);
            const overlayHeight = parseInt(cropOverlay.style.height);
            
            // Convert overlay position to canvas coordinates
            const cropX = Math.max(0, (overlayLeft - canvasLeft) * scaleX);
            const cropY = Math.max(0, (overlayTop - canvasTop) * scaleY);
            const cropWidth = Math.min(overlayWidth * scaleX, canvas.width - cropX);
            const cropHeight = Math.min(overlayHeight * scaleY, canvas.height - cropY);
            
            // Get cropped image data
            const imageData = ctx.getImageData(cropX, cropY, cropWidth, cropHeight);
            
            // Create new canvas with cropped dimensions
            canvas.width = cropWidth;
            canvas.height = cropHeight;
            ctx.putImageData(imageData, 0, 0);
            
            // Update stored original data
            originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            cancelCrop();
            showMessage('‚úÖ Crop applied perfectly!', 'success');
        }
        
        function cancelCrop() {
            if (cropOverlay) {
                cropOverlay.remove();
                cropOverlay = null;
            }
            cropMode = false;
            document.getElementById('cropControls').style.display = 'none';
            showMessage('‚ùå Crop cancelled', 'info');
        }
        
        // Hair Style Changer
        function changeHairStyle(style) {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            
            showMessage(`üíá Applying ${style} hair style...`, 'info');
            
            // Simulate hair style change (in real app, use AI service)
            setTimeout(() => {
                showMessage(`‚úÖ ${style} hair style applied!`, 'success');
            }, 1000);
        }
        
        function changeHairColor() {
            const color = prompt('Enter hair color (e.g., blonde, brown, black):');
            if (color) {
                showMessage(`üé® Changing hair color to ${color}...`, 'info');
                setTimeout(() => {
                    showMessage(`‚úÖ Hair color changed to ${color}!`, 'success');
                }, 1000);
            }
        }
        
        // Floating AI Assistant
        function toggleAI() {
            const chat = document.getElementById('aiChat');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }
        
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = getAIResponse(message);
                addMessage(response, 'ai');
            }, 500);
        }
        
        function addMessage(text, sender) {
            const messages = document.getElementById('aiMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            div.innerHTML = sender === 'ai' ? `ü§ñ WAJID: ${text}` : text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
        
        let brushMode = false;
        let isDrawing = false;
        let brushSize = 20;
        
        // Canva-style background removal
        function canvaStyleRemoval() {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            
            showMessage('üé® Canva-style background removal...', 'info');
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // Advanced edge detection and background removal
            const edges = detectEdges(data, canvas.width, canvas.height);
            
            for (let i = 0; i < data.length; i += 4) {
                const pixelIndex = i / 4;
                const x = pixelIndex % canvas.width;
                const y = Math.floor(pixelIndex / canvas.width);
                
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Multi-criteria background detection
                const brightness = (r + g + b) / 3;
                const colorVariance = Math.abs(r - g) + Math.abs(g - b) + Math.abs(r - b);
                const isEdge = edges[pixelIndex];
                
                // Canva-style logic: preserve edges, remove uniform backgrounds
                if (!isEdge && brightness > 160 && colorVariance < 40) {
                    // Gradual transparency for smooth edges
                    const edgeDistance = getEdgeDistance(x, y, edges, canvas.width, canvas.height);
                    const alpha = Math.max(0, Math.min(255, edgeDistance * 50));
                    data[i + 3] = alpha;
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            showMessage('‚úÖ Canva-style removal complete!', 'success');
        }
        
        // Edge detection algorithm
        function detectEdges(data, width, height) {
            const edges = new Array(width * height).fill(false);
            const threshold = 30;
            
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const i = (y * width + x) * 4;
                    
                    // Get surrounding pixels
                    const current = data[i] + data[i + 1] + data[i + 2];
                    const right = data[i + 4] + data[i + 5] + data[i + 6];
                    const bottom = data[i + width * 4] + data[i + width * 4 + 1] + data[i + width * 4 + 2];
                    
                    // Check for significant color change (edge)
                    if (Math.abs(current - right) > threshold || Math.abs(current - bottom) > threshold) {
                        edges[y * width + x] = true;
                    }
                }
            }
            
            return edges;
        }
        
        // Get distance to nearest edge
        function getEdgeDistance(x, y, edges, width, height) {
            let minDistance = 10;
            
            for (let dy = -5; dy <= 5; dy++) {
                for (let dx = -5; dx <= 5; dx++) {
                    const nx = x + dx;
                    const ny = y + dy;
                    
                    if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                        if (edges[ny * width + nx]) {
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            minDistance = Math.min(minDistance, distance);
                        }
                    }
                }
            }
            
            return minDistance;
        }
        
        // Brush mode for manual removal
        function enableBrushMode() {
            brushMode = true;
            colorPickerMode = false;
            cropMode = false;
            
            const canvas = document.getElementById('editorCanvas');
            canvas.style.cursor = 'crosshair';
            showMessage('üñåÔ∏è Brush mode: Click and drag to erase background', 'info');
            
            canvas.addEventListener('mousedown', startBrush);
            canvas.addEventListener('mousemove', brushErase);
            canvas.addEventListener('mouseup', endBrush);
            
            // Brush size will be handled in editor modal
        }
        
        function startBrush(e) {
            if (!brushMode) return;
            isDrawing = true;
            brushErase(e);
        }
        
        function brushErase(e) {
            if (!brushMode || !isDrawing) return;
            
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Erase in circular brush pattern
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalCompositeOperation = 'source-over';
        }
        
        function endBrush() {
            isDrawing = false;
        }
        
        // Enhanced color picker with tolerance
        function removeColorFromImage(targetR, targetG, targetB) {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            const tolerance = 40; // Increased tolerance for better removal
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Enhanced color distance calculation
                const distance = Math.sqrt(
                    Math.pow(r - targetR, 2) * 0.3 +
                    Math.pow(g - targetG, 2) * 0.59 +
                    Math.pow(b - targetB, 2) * 0.11
                );
                
                if (distance < tolerance) {
                    // Gradual transparency based on similarity
                    const alpha = Math.max(0, (distance / tolerance) * 255);
                    data[i + 3] = alpha;
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            showMessage('üé® Color removed with smooth edges!', 'success');
        }
        
        // AI Background Removal using Remove.bg API
        async function aiBackgroundRemoval() {
            const canvas = document.getElementById('editorCanvas');
            const imageBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
            
            showMessage('ü§ñ AI removing background...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('image_file', imageBlob);
                formData.append('size', 'auto');
                
                const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST',
                    headers: {
                        'X-Api-Key': 'uam3YSA7Dkz6SHVkf8DLVWUE'
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const img = new Image();
                    img.onload = function() {
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                        showMessage('‚úÖ AI background removed perfectly!', 'success');
                    };
                    img.src = URL.createObjectURL(blob);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.errors?.[0]?.title || 'API failed');
                }
            } catch (error) {
                console.error('Remove.bg error:', error);
                showMessage(`‚ö†Ô∏è API Error: ${error.message}. Using local removal...`, 'warning');
                canvaStyleRemoval();
            }
        }
        
        // AI Assistant
        function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) return;
            
            const response = getAIResponse(question);
            document.getElementById('aiAnswer').innerHTML = response;
            document.getElementById('aiResponse').style.display = 'block';
            document.getElementById('aiQuestion').value = '';
        }
        
        function getAIResponse(question) {
            const q = question.toLowerCase();
            
            if (q.includes('hi') || q.includes('hello')) {
                return 'Hello! I\'m WAJID Assistant. I can help you create perfect passport photos, remove backgrounds, crop images, and more!';
            }
            
            if (q.includes('what can you do') || q.includes('help me')) {
                return 'I can help you with:<br>‚Ä¢ Remove backgrounds using AI<br>‚Ä¢ Crop photos professionally<br>‚Ä¢ Change background colors<br>‚Ä¢ Create passport photos<br>‚Ä¢ Print and save photos<br>‚Ä¢ Hair style editing<br>Ask me anything specific!';
            }
            
            if (q.includes('remove') && (q.includes('background') || q.includes('bg'))) {
                return 'To remove background:<br>1. Click "AI Remove (API)" for best results<br>2. Use "Brush Remove" to manually erase<br>3. Try "Pick Color" to remove specific colors<br>Your Remove.bg API gives perfect results!';
            }
            
            if (q.includes('crop')) {
                return 'For cropping:<br>1. Click "Start Cropping" in editor<br>2. Drag the box to move it<br>3. Drag corners to resize<br>4. Click "Apply" when done<br>The crop box should appear over your photo!';
            }
            
            if (q.includes('hair') || q.includes('hairstyle')) {
                return 'Hair editing options:<br>‚Ä¢ Short Hair - Professional look<br>‚Ä¢ Long Hair - Feminine style<br>‚Ä¢ Curly Hair - Textured style<br>‚Ä¢ Bald - Clean look<br>‚Ä¢ Change Hair Color - Any color you want!';
            }
            
            if (q.includes('passport') || q.includes('photo size')) {
                return 'For passport photos:<br>‚Ä¢ Use 2"√ó2" dimensions<br>‚Ä¢ White background recommended<br>‚Ä¢ Center your face<br>‚Ä¢ Good lighting is important<br>‚Ä¢ Use "Auto Face Crop" for perfect positioning!';
            }
            
            if (q.includes('color') || q.includes('background color')) {
                return 'Background colors:<br>‚Ä¢ White - Official documents, passports<br>‚Ä¢ Blue - Visas, professional photos<br>‚Ä¢ Red - Emergency IDs<br>‚Ä¢ Gray - Casual IDs<br>Use the color picker for custom colors!';
            }
            
            if (q.includes('print') || q.includes('save')) {
                return 'To print/save:<br>‚Ä¢ Click "Save" to download PNG<br>‚Ä¢ Click "Print" for direct printing<br>‚Ä¢ Use high-resolution photos (300+ DPI)<br>‚Ä¢ Photo paper gives best results!';
            }
            
            if (q.includes('wajid') || q.includes('name')) {
                return 'Yes, I\'m WAJID Assistant! I\'m here to help you create perfect photos. What would you like to do today?';
            }
            
            return 'I\'m WAJID Assistant! I can help with background removal, cropping, passport photos, printing, and more. What specific help do you need?';
        }
        
        // Enter key support for AI chat
        document.addEventListener('DOMContentLoaded', function() {
            const aiInput = document.getElementById('aiInput');
            if (aiInput) {
                aiInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendAIMessage();
                    }
                });
            }
        });
        
        let originalCanvasData = null;
        
        function changeBgColor(color) {
            backgroundColor = color;
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            
            // Store original if not stored
            if (!originalCanvasData) {
                originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
            
            // Use original data for color change
            const imageData = ctx.createImageData(originalCanvasData);
            const data = imageData.data;
            const originalData = originalCanvasData.data;
            
            // Copy original data
            for (let i = 0; i < data.length; i++) {
                data[i] = originalData[i];
            }
            
            // Convert hex color to RGB
            const hex = color.replace('#', '');
            const bgR = parseInt(hex.substr(0, 2), 16);
            const bgG = parseInt(hex.substr(2, 2), 16);
            const bgB = parseInt(hex.substr(4, 2), 16);
            
            // Apply new background color to transparent areas
            for (let i = 0; i < data.length; i += 4) {
                const alpha = data[i + 3] / 255;
                
                if (alpha < 1) {
                    // Blend with new background color
                    data[i] = data[i] * alpha + bgR * (1 - alpha);
                    data[i + 1] = data[i + 1] * alpha + bgG * (1 - alpha);
                    data[i + 2] = data[i + 2] * alpha + bgB * (1 - alpha);
                    data[i + 3] = 255; // Make opaque
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            showMessage(`üé® Background changed to ${color}`, 'success');
        }
        
        // External Background Removal Services
        function openRemoveBg() {
            if (!selectedImage) {
                alert('Please upload an image first!');
                return;
            }
            
            showMessage('üöÄ Opening Remove.bg - Best AI background remover!', 'info');
            window.open('https://www.remove.bg/', '_blank');
            showUploadSection();
        }
        
        function openPhotoscissors() {
            if (!selectedImage) {
                alert('Please upload an image first!');
                return;
            }
            
            showMessage('‚úÇÔ∏è Opening PhotoScissors - Free online editor!', 'info');
            window.open('https://photoscissors.com/', '_blank');
            showUploadSection();
        }
        
        function openBgEraser() {
            if (!selectedImage) {
                alert('Please upload an image first!');
                return;
            }
            
            showMessage('üñºÔ∏è Opening BgEraser - AI background remover!', 'info');
            window.open('https://bgeraser.com/', '_blank');
            showUploadSection();
        }
        
        function openCanva() {
            if (!selectedImage) {
                alert('Please upload an image first!');
                return;
            }
            
            showMessage('üé® Opening Canva - Professional photo editor!', 'info');
            window.open('https://www.canva.com/photo-editor/', '_blank');
            showUploadSection();
        }
        
        function openPixlr() {
            if (!selectedImage) {
                alert('Please upload an image first!');
                return;
            }
            
            showMessage('üñºÔ∏è Opening Pixlr - Advanced photo editor!', 'info');
            window.open('https://pixlr.com/editor/', '_blank');
            showUploadSection();
        }
        
        function openExternalEditor() {
            const modal = document.createElement('div');
            modal.className = 'editor-modal';
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 500px; text-align: center;">
                    <h2>üåç Choose Online Editor</h2>
                    <p style="margin: 15px 0; color: #666;">Select the best free background removal tool:</p>
                    
                    <button class="preset-btn" onclick="openRemoveBg(); closeModal();" style="width: 100%; margin: 8px 0; background: linear-gradient(135deg, #4CAF50, #45a049);">
                        üöÄ Remove.bg - Best AI (5 free/month)
                    </button>
                    
                    <button class="preset-btn" onclick="openPhotoscissors(); closeModal();" style="width: 100%; margin: 8px 0; background: linear-gradient(135deg, #2196F3, #1976D2);">
                        ‚úÇÔ∏è PhotoScissors - Unlimited Free
                    </button>
                    
                    <button class="preset-btn" onclick="openBgEraser(); closeModal();" style="width: 100%; margin: 8px 0; background: linear-gradient(135deg, #FF9800, #F57C00);">
                        üñºÔ∏è BgEraser - AI Free
                    </button>
                    
                    <button class="preset-btn" onclick="openCanva(); closeModal();" style="width: 100%; margin: 8px 0; background: linear-gradient(135deg, #9C27B0, #7B1FA2);">
                        üé® Canva - Professional Editor
                    </button>
                    
                    <button class="preset-btn" onclick="openPixlr(); closeModal();" style="width: 100%; margin: 8px 0; background: linear-gradient(135deg, #E91E63, #C2185B);">
                        üñºÔ∏è Pixlr - Advanced Tools
                    </button>
                    
                    <button onclick="closeModal()" style="margin-top: 15px; padding: 10px 20px; background: #ccc; border: none; border-radius: 8px; cursor: pointer;">Cancel</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeModal() {
            const modal = document.querySelector('.editor-modal');
            if (modal) modal.remove();
        }
        
        function showUploadSection() {
            document.getElementById('uploadSection').style.display = 'block';
            showMessage('üîÑ After editing, upload your photo back here!', 'info');
        }
        
        // Handle edited image upload (removed - element doesn't exist)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize brush size display
            const brushSizeSlider = document.getElementById('brushSize');
            const brushSizeValue = document.getElementById('brushSizeValue');
            if (brushSizeSlider && brushSizeValue) {
                brushSizeSlider.addEventListener('input', function() {
                    brushSize = this.value;
                    brushSizeValue.textContent = brushSize + 'px';
                });
            }
        });
        
        function cropToFace() {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            
            // Smart face crop - square format, centered with slight upward bias
            const size = Math.min(canvas.width, canvas.height) * 0.8;
            const x = (canvas.width - size) / 2;
            const y = (canvas.height - size) / 3; // Better face positioning
            
            const croppedData = ctx.getImageData(x, y, size, size);
            canvas.width = size;
            canvas.height = size;
            ctx.putImageData(croppedData, 0, 0);
            
            // Update stored original data
            originalCanvasData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            showMessage('‚úÖ Auto face crop applied!', 'success');
        }
        
        function resizeImage(scale) {
            document.getElementById('resizeValue').textContent = scale + '%';
            // Implementation for resize
        }
        
        function adjustBrightness(value) {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            ctx.filter = `brightness(${100 + parseInt(value)}%)`;
            loadImageToEditor();
        }
        
        function adjustContrast(value) {
            const canvas = document.getElementById('editorCanvas');
            const ctx = canvas.getContext('2d');
            ctx.filter = `contrast(${100 + parseInt(value)}%)`;
            loadImageToEditor();
        }
        
        function smoothSkin() {
            showMessage('üåü Skin smoothing applied!', 'success');
        }
        
        function whitenTeeth() {
            showMessage('üòÅ Teeth whitening applied!', 'success');
        }
        
        function brightenEyes() {
            showMessage('üëÅÔ∏è Eyes brightened!', 'success');
        }
        
        function applyEdits() {
            const canvas = document.getElementById('editorCanvas');
            selectedImage = canvas.toDataURL();
            updatePhotoGrid();
            closeEditor();
            showMessage('‚úÖ Photo edits applied!', 'success');
        }
        
        function resetEdits() {
            selectedImage = originalImage;
            loadImageToEditor();
            showMessage('üîÑ Photo reset to original!', 'info');
        }

        // Initialize
        updatePhotoGrid();
    </script>
</body>
</html>